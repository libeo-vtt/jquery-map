!function(t){var i=function(i,e){this.mapWrapper=t(i),this.mapObj=null,this.map=null,this.defaults={key:"",locked:!1,loadAPI:!0,markersSelector:".marker",fitCenterMarkers:!0,lat:0,lng:0,zoom:0,maxZoom:18,minZoom:0,styles:[],markers:[],geoJson:null,featuresStyles:null,events:null,infobox:!1,classes:{mapInnerWrapper:"",states:{active:"is-active"}}},this.map=null,this.classes=t.extend(!0,this.defaults.classes,window.project?window.project.classes:{}),this.labels=t.extend(!0,this.defaults.labels,window.project?window.project.labels:{}),this.config=t.extend(!0,this.defaults,e||{}),this.$htmlMarkers=t(this.config.markersSelector),this.markers=[],this.infoWindows=[],this.publicMethods={refreshMap:t.proxy(function(){this.refreshMap()},this)},this.init()};t.extend(i.prototype,{init:function(){this.config.loadAPI?(window.googleAPI||this.loadAPI(),t(window).on("googleAPI",t.proxy(this.callback,this))):this.createMap()},loadAPI:function(){window.googleAPI=!0;var i="sensor=false";""!=this.config.key&&(i=i+"&key="+this.config.key),t.getScript("https://www.google.com/jsapi",t.proxy(function(){window.google.maps||google.load("maps","3",{other_params:i,callback:t.proxy(function(){this.config.infobox?jQuery.getScript(this.config.infobox,t.proxy(function(){t(window).trigger("googleAPI")},this)):t(window).trigger("googleAPI")},this)})},this))},callback:function(){this.createMap()},createMap:function(){this.mapWrapper.html('<div class="'+this.config.classes.mapInnerWrapper+'"></div>'),this.$mapObj=this.mapWrapper.find("."+this.config.classes.mapInnerWrapper),this.mapObj=this.$mapObj.get(0),this.$mapObj.css("height","100%"),this.bounds=new window.google.maps.LatLngBounds,this.map=new window.google.maps.Map(this.mapObj,{mapTypeId:"roadmap",disableDefaultUI:!0,center:new window.google.maps.LatLng(this.config.lat,this.config.lng),zoom:this.config.zoom,maxZoom:this.config.maxZoom,minZoom:this.config.minZoom,styles:this.config.styles}),this.bindMapEvents(),this.addMarkersJs(),this.$htmlMarkers.length>0&&this.addMarkersHTML(),this.config.geoJson&&this.map.data.loadGeoJson(this.config.geoJson),this.config.featuresStyles&&(t.isFunction(this.config.featuresStyles)?this.map.data.setStyle(t.proxy(this.config.featuresStyles,null,this.map)):this.map.data.setStyle(this.config.featuresStyles)),this.config.events&&this.config.events(this.map),this.config.fitCenterMarkers===!0&&this.fitCenterBounds(),this.config.locked===!0&&this.lockMap()},addMarkersJs:function(){var i=this.config.markers.length;_.each(this.config.markers,t.proxy(function(t){t.position=new window.google.maps.LatLng(t.lat,t.lng),this.addMarker(t),i>1&&(this.bounds.extend(t.position),this.map.fitBounds(this.bounds))},this))},addMarkersHTML:function(){this.bindHtmlMarkerEvents(this.$htmlMarkers),_.each(this.$htmlMarkers,t.proxy(function(i){var e={},o=t(i);o.attr("data-lat")&&0!=parseFloat(o.attr("data-lat"))&&o.attr("data-lng")&&0!=parseFloat(o.attr("data-lng"))&&(e.position=new window.google.maps.LatLng(o.attr("data-lat"),o.attr("data-lng")),""!=o.attr("data-icon")&&void 0!=o.attr("data-icon")?e.icon=o.attr("data-icon"):""!=this.mapWrapper.attr("data-icon")&&void 0!=this.mapWrapper.attr("data-icon")?e.icon=this.mapWrapper.attr("data-icon"):e.icon="",""!=o.attr("data-icon-hover")&&void 0!=o.attr("data-icon-hover")?e.iconHover=o.attr("data-icon-hover"):""!=this.mapWrapper.attr("data-icon-hover")&&void 0!=this.mapWrapper.attr("data-icon-hover")?e.iconHover=this.mapWrapper.attr("data-icon-hover"):e.iconHover="",""!=o.attr("data-icon-width")&&void 0!=o.attr("data-icon-width")?e.iconWidth=parseInt(o.attr("data-icon-width")):""!=this.mapWrapper.attr("data-icon-width")&&void 0!=this.mapWrapper.attr("data-icon-width")?e.iconWidth=parseInt(this.mapWrapper.attr("data-icon-width")):e.iconWidth="",""!=o.attr("data-icon-height")&&void 0!=o.attr("data-icon-height")?e.iconHeight=parseInt(o.attr("data-icon-height")):""!=this.mapWrapper.attr("data-icon-height")&&void 0!=this.mapWrapper.attr("data-icon-height")?e.iconHeight=parseInt(this.mapWrapper.attr("data-icon-height")):e.iconHeight="",e.title=o.attr("data-title"),e.id=o.attr("data-id"),e.infoWindowContent=o.find(".marker-popup-content").html(),this.addMarker(e),this.$htmlMarkers.length>1&&(this.bounds.extend(e.position),this.map.fitBounds(this.bounds)))},this))},addMarker:function(i){var e="",o=i.icon,a=i.iconHover;""!==i.iconWidth&&void 0!==i.iconWidth&&""!==i.iconHeight&&void 0!==i.iconHeight&&""!=i.icon&&void 0!=i.icon&&""!=i.iconHover&&void 0!=i.iconHover&&(o={url:i.icon,scaledSize:new google.maps.Size(i.iconWidth,i.iconHeight)},a={url:i.iconHover,scaledSize:new google.maps.Size(i.iconWidth,i.iconHeight)});var n=new window.google.maps.Marker({position:i.position,map:this.map,icon:o,iconDefault:o,iconHover:a,title:i.title,customId:i.id});if(this.markers[i.id]=n,this.bindMapsMarkerEvents(n),""!=i.infoWindowContent&&null!=i.infoWindowContent)if(this.config.infobox){var s={content:i.infoWindowContent,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size((-100),0),zIndex:null,boxStyle:{background:"transparent",opacity:1,width:"200px"},closeBoxMargin:"0px 0px 0px 0px",closeBoxURL:!1,infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1},r=t.extend(!0,this.config.infobox,s||{});e=new InfoBox(r),this.infoWindows.push(e),this.bindInfoWindowEvent(n,e)}else e=new google.maps.InfoWindow({content:i.infoWindowContent}),this.infoWindows.push(e),this.bindInfoWindowEvent(n,e)},bindInfoWindowEvent:function(i,e){i.addListener("click",t.proxy(function(){_.each(this.infoWindows,t.proxy(function(t){t.close()},this)),_.each(this.markers,t.proxy(function(t){void 0!=t&&this.resetMarker(t)},this)),e.open(this.map,i),i.isClicked=!0,this.changeMarkerIcon(i,"hover"),t('[data-id="'+i.customId+'"]').addClass(this.config.classes.states.active)},this)),e.addListener("closeclick",t.proxy(function(){_.each(this.markers,t.proxy(function(t){void 0!=t&&this.resetMarker(t)},this))},this))},bindMapEvents:function(){window.google.maps.event.addDomListener(window,"resize",t.proxy(function(){var t=this.map.getCenter();window.google.maps.event.trigger(this.map,"resize"),this.map.setCenter(t)},this))},bindHtmlMarkerEvents:function(i){i.on("mouseenter",t.proxy(function(i){var e=this.markers[t(i.currentTarget).attr("data-id")];this.changeMarkerIcon(e,"hover")},this)),i.on("mouseleave",t.proxy(function(i){var e=this.markers[t(i.currentTarget).attr("data-id")];this.changeMarkerIcon(e,"default")},this))},bindMapsMarkerEvents:function(i){var e=t('[data-id="'+i.customId+'"]');google.maps.event.addListener(i,"mouseover",t.proxy(function(){e.addClass(this.classes.states.active),this.changeMarkerIcon(i,"hover")},this)),google.maps.event.addListener(i,"mouseout",t.proxy(function(){i.isClicked!==!0&&(e.removeClass(this.classes.states.active),this.changeMarkerIcon(i,"default"))},this))},changeMarkerIcon:function(t,i){if(t){var e=t.iconDefault;"hover"===i&&(e=t.iconHover),""!=e&&t.setIcon(e)}},lockMap:function(){this.$mapObj.css("pointer-events","none"),this.bindLockMapEvents()},bindLockMapEvents:function(){this.mapWrapper.on("click",t.proxy(function(){this.mapWrapper.addClass(this.classes.states.active),this.$mapObj.css("pointer-events","auto")},this)),this.mapWrapper.on("mouseleave",t.proxy(function(){this.mapWrapper.removeClass(this.classes.states.active),this.$mapObj.css("pointer-events","none")},this))},refreshMap:function(){window.google.maps.event.trigger(this.map,"resize"),this.config.fitCenterMarkers===!0?this.fitCenterBounds():this.map.setCenter(new window.google.maps.LatLng(this.config.lat,this.config.lng))},fitCenterBounds:function(){if(this.markers.length>1){var i=new google.maps.LatLngBounds;_.each(this.markers,t.proxy(function(t){void 0!=t&&i.extend(t.getPosition())},this)),this.map.fitBounds(i)}else this.map.setCenter(new window.google.maps.LatLng(this.config.lat,this.config.lng))},resetMarker:function(i){i.isClicked=!1,this.changeMarkerIcon(i,"default"),t('[data-id="'+i.customId+'"]').removeClass(this.config.classes.states.active)}}),t.fn.customMap=function(e){return this.each(t.proxy(function(o,a){var n=t(a);if(!n.data("custom-map")){var s=new i(a,e);for(var r in s.publicMethods)this[r]=s.publicMethods[r];n.data("custom-map",s)}},this)),this}}(jQuery);